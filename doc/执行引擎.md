graph TB
    subgraph "INPUT"
        CMD[ExecutionCommand<br/>from Pre-Process]
        CAN[CancelCommand<br/>撤单指令]
        
        subgraph "Command Details"
            CD1[OrderType: Market/Limit]
            CD2[Symbol: BTC/ETH/...]
            CD3[Exchange: Binance/OKEx]
            CD4[Priority: Normal/High/Highest]
        end
        
        CMD --> CD1
        CMD --> CD2
        CMD --> CD3
        CMD --> CD4
    end
    
    subgraph "Trading Engine Core"
        subgraph "WebSocket Pool"
            WPM[Pool Manager]
            
            subgraph "Spot Connections"
                SW1[Spot WS#1<br/>Health: 95]
                SW2[Spot WS#2<br/>Health: 88]
                SW3[Spot WS#3<br/>Health: 76]
            end
            
            subgraph "Futures Connections"
                FW1[Futures WS#1<br/>Health: 92]
                FW2[Futures WS#2<br/>Health: 90]
                FW3[Futures WS#3<br/>Health: 85]
            end
            
            WPM --> SW1
            WPM --> SW2
            WPM --> SW3
            WPM --> FW1
            WPM --> FW2
            WPM --> FW3
        end
        
        subgraph "Execution Pipeline"
            RT[Router<br/>路由选择]
            SN[Signer<br/>签名器]
            ID[Idempotent<br/>幂等保证]
            EX[Executor<br/>执行器]
            
            RT --> SN --> ID --> EX
        end
        
        subgraph "Response Handler"
            PS[Parser<br/>解析器]
            VL[Validator<br/>验证器]
            EM[Emitter<br/>发射器]
            
            PS --> VL --> EM
        end
    end
    
    subgraph "OUTPUT"
        subgraph "Response Types"
            ACK[OrderACK<br/>订单确认]
            FIL[FillReport<br/>成交回报]
            REJ[RejectReport<br/>拒绝回报]
            ERR[ErrorEvent<br/>错误事件]
        end
        
        OUT[Output Channel<br/>to Post-Process]
        
        ACK --> OUT
        FIL --> OUT
        REJ --> OUT
        ERR --> OUT
    end
    
    subgraph "External"
        EXC[Exchange APIs<br/>Binance/OKEx/Bybit]
    end
    
    CMD --> RT
    CAN --> RT
    
    EX --> EXC
    EXC --> PS
    
    EM --> ACK
    EM --> FIL
    EM --> REJ
    EM --> ERR
    
    style CMD fill:#667eea,color:#fff
    style WPM fill:#4CAF50,color:#fff
    style EXC fill:#f44336,color:#fff
    style OUT fill:#FF9800,color:#fff